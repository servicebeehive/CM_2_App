<div class="card p-6">
    <!-- Header Row: Stock In + Buttons -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
        <span class="block text-surface-900 font-bold text-2xl">Invoice</span>
        
        <!-- Buttons - Hidden on mobile, shown in header on desktop -->
        <div class="hidden md:flex gap-4">
            <button pButton type="button" label="Display" class="p-button-warning" 
                [disabled]="invoiceForm.invalid" (click)="display()">
            </button>
            <button pButton type="submit" label="Submit" class="p-button-warning" 
                (click)="submit()" [disabled]="submitDisable">
            </button>
            <button pButton type="button" label="Reset" 
                class="p-button-secondary" (click)="reset()">
            </button>
        </div>
    </div>

    <form [formGroup]="invoiceForm" class="space-y-8">
        <!-- ðŸ· Product Info Section -->
        <div class="space-y-6">
            <!-- First Row: Customer Mobile and Dates -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-4 w-full">
                <!-- Customer Mobile -->
                <div class="flex flex-col">
                    <label class="font-medium mb-1">Customer Mobile</label>
                    <p-dropdown [options]="cusMobileOptions" optionLabel="fieldname" optionValue="fieldid" 
                        [filter]="true" [showClear]="true" filterPlaceholder="Search Customer Mobile" 
                        formControlName="p_mobile" placeholder="Customer Mobile" class="w-full">
                    </p-dropdown>
                </div>

                <!-- Transaction Date From-->
                <div class="flex flex-col">
                    <label class="font-medium mb-1">From Date <span class="text-red-500">*</span></label>
                    <p-datepicker fluid formControlName="fromDate" dateFormat="dd/mm/yy" 
                        [showIcon]="true" placeholder="From Date" class="w-full">
                    </p-datepicker>
                    <small class="text-red-500 ms-3 mt-1" *ngIf="invoiceForm.get('fromDate')?.touched">
                        <span *ngIf="invoiceForm.get('fromDate')?.errors?.['required']">From Date is required</span>
                    </small>
                </div>

                <!-- Empty div for grid alignment on desktop -->
                <div class="hidden md:block"></div>

                <!-- Transaction Date To -->
                <div class="flex flex-col">
                    <label class="font-medium mb-1">To Date <span class="text-red-500">*</span></label>
                    <p-datepicker fluid formControlName="toDate" dateFormat="dd/mm/yy" 
                        [showIcon]="true" placeholder="To Date" class="w-full">
                    </p-datepicker>
                    <small class="text-red-500 ms-3 mt-1" *ngIf="invoiceForm.get('toDate')?.touched">
                        <span *ngIf="invoiceForm.get('toDate')?.errors?.['required']">To Date is required</span>
                        <span *ngIf="invoiceForm.errors?.['dateRangeInvalid'] && invoiceForm.get('toDate')?.touched">
                            To Date must be greater than or equal to From Date
                        </span>
                    </small>
                </div>
            </div>

            <!-- Second Row: Customer Name and Status -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full">
                <!-- Customer Name -->
                <div class="flex flex-col">
                    <label class="font-medium mb-1">Customer Name</label>
                    <p-dropdown [options]="cusNameOptions" optionLabel="fieldname" optionValue="fieldid" 
                        [filter]="true" [showClear]="true" filterPlaceholder="Search Customer Name" 
                        formControlName="p_cusname" placeholder="Customer Name" class="w-full">
                    </p-dropdown>
                </div>

                <!-- Status -->
                <div class="flex flex-col">
                    <label class="font-medium mb-1">Status</label>
                    <p-dropdown [options]="statusOptions" optionLabel="fieldname" [showClear]="true" 
                        optionValue="fieldid" [filter]="true" filterPlaceholder="Select Status" 
                        formControlName="status" placeholder="Status" class="w-full">
                    </p-dropdown>
                </div>
            </div>

            <!-- Action Buttons - Visible only on mobile, below Customer Name and Status -->
            <div class="flex md:hidden justify-center gap-4 mt-4">
                <button pButton type="button" label="Display" class="p-button-warning flex-1" 
                    [disabled]="invoiceForm.invalid" (click)="display()">
                </button>
                <button pButton type="submit" label="Submit" class="p-button-warning flex-1" 
                    (click)="submit()" [disabled]="submitDisable">
                </button>
                <button pButton type="button" label="Reset" 
                    class="p-button-secondary flex-1" (click)="reset()">
                </button>
            </div>
        </div>

        <!-- Product Table with Pagination -->
        <div>
            <p-table [value]="filteredProducts" dataKey="code" [tableStyle]="{ 'min-width': '50rem' }" 
                [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5, 10, 20, 50]" 
                [responsiveLayout]="'scroll'" class="p-datatable-gridlines mt-6 invoice">
                
                <ng-template #header>
                    <tr class="bg-yellow-400">
                        <th>Invoice No</th>
                        <th>Invoice Date</th>
                        <th>Transaction Type</th>
                        <th>Customer</th>
                        <th>Total Amount</th>
                        <th>Paid Amount</th>
                        <th>Due Amount</th>
                        <th style="width:140px; min-width:160px; max-width:160px;">Received Amount</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-row let-i="rowIndex">
                    <tr>
                        <td>{{ row.invoice_no }}</td>
                        <td>{{ row.invoice_date | date: 'dd/MM/yyyy' }}</td>
                        <td>{{ row.transactiontype }}</td>
                        <td>{{ row.customer }}</td>
                        <td>{{ row.total_amount }}</td>
                        <td>{{ row.paid_amount }}</td>
                        <td>{{ row.due_amount }}</td>
                        <td style="width:140px; min-width:160px; max-width:160px;">
                            <div class="grid items-center gap-2">
                                <input
                                    type="number"
                                    class="w-full"  
                                    pInputText
                                    [disabled]="!canPrint(row)"
                                    [(ngModel)]="row.received_amount"
                                    (ngModelChange)="updateReceivedAmount(i,$event)"
                                    [ngModelOptions]="{standalone:true}"
                                    (input)="validateReceivedAmount(row)"
                                    placeholder="Amount"
                                    (keydown)="blockMinus($event)"
                                />
                                <small class="text-red-500" *ngIf="row.amountError">
                                    This cannot be greater than {{row.due_amount}}
                                </small>
                            </div>
                        </td>
                        <td>{{ row.status }}</td>
                        <td class="text-center w-[60px]">
                            <div class="flex g-2">
                                <button pButton type="button" icon="pi pi-print" class="p-button-text p-button-sm" 
                                    printSectionId="invoicePrintSection" (click)="printInvoice(row)" 
                                    [disabled]="!canPrint(row)">
                                </button>
                                <button pButton type="button" icon="pi pi-folder-open" 
                                    class="p-button-text p-button-sm text-red-500" (click)="openInvoice(row)" 
                                    pTooltip="Open in Sale Page" tooltipPosition="top">
                                </button>
                            </div>
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="paginatorleft">
                    <div class="text-gray-600 ms-2">Total Items: {{ filteredProducts?.length || 0 }}</div>
                </ng-template>
            </p-table>
        </div>
    </form>

    <!-- Confirm Dialog -->
    <p-confirmDialog></p-confirmDialog>
</div>

<!-- PRINT SECTION remains the same -->
<div id="invoicePrintSection" style="width: 900px; margin: auto; font-family: Arial">
    <!-- ... existing print section content ... -->
</div>