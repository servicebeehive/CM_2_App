<div class="card p-6">
  <div>
      <form [formGroup]="CreditForm"  class="space-y-8">
  <!-- Header Row: Stock In + Buttons -->
  <div class="flex justify-between items-center mb-6">
    <span class="block text-surface-900 font-bold text-2xl">Debit/Credit Link</span>
        <div class="flex  gap-4">
  <button pButton type="button" label="Generate DN" class="p-button-primary" [disabled]="CreditForm.invalid ||saleArray.length === 0 ||CreditForm.get('p_debitNote')?.value" (click)="Ganratedn('DEBITNOTE')"></button> 
        <button pButton type="button" label="Link CN" class="p-button-primary" [disabled]="CreditForm.get('p_debitNote')?.value == null" (click)="Ganratedn('CREDITNOTE')"></button>
        <button pButton type="button" label="Print" class="p-button-primary" (click)="print()" [disabled]="!CreditForm.get('p_debitNote')?.value"></button> 
         <button pButton type="button" label="Reset" class="p-button-secondary" (click)="reset()"></button>
    </div>
  </div>

 

    <!-- ðŸ· Product Info Section -->
      <!-- Two-column grid layout -->
      <div class="grid grid-cols-3 gap-x-8 gap-y-4 w-full">
 <!-- CREDIT NOTE -->
      
         
        <div class="flex flex-col">
            <label class="font-medium mb-1">Debit Note</label>
           <p-dropdown (onChange)="RetunCredit($event)"
            [options]="debittnotList" 
            optionLabel="fieldid"
            optionValue="fieldid" [showClear]="true" 
            [filter]="true" 
            filterPlaceholder="Select Debit Note"
            formControlName="p_debitNote"
            placeholder="Debit Note" (onClear)="reset()">
          </p-dropdown>
        
        </div>

         <!-- Vendor Name -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Vendor Name <span class="text-red-500">*</span></label>

           <p-dropdown
            [options]="this.vendorOptions"
            optionLabel="fieldname"
            optionValue="fieldid"
            [filter]="true"
            filterPlaceholder="Search Vendor Name"
            formControlName="p_vendorid"
            placeholder="Vendor Name">
          </p-dropdown>
          <small class="text-red-500 ms-3 mt-1" *ngIf="CreditForm.get('p_vendorid')?.touched">
            <span *ngIf="CreditForm.get('p_vendorid')?.errors?.['required']">Vendor Name is required</span>
          </small>
        </div>

          <!-- DEBIT NOTE -->
<div class="flex flex-col">
        <label class="font-medium mb-1">Credit Note</label>
          <input
          pInputText
          placeholder="Credit Note"
           formControlName="p_creditNote"
           />
      </div>

</div>
    <!-- Product Table with Pagination -->
    <div>
     <p-table
  [value]="replacecednlist"
  dataKey="transactiondetailid"
  [(selection)]="selectedItems"
  (selectionChange)="onSelectionChange($event)"
 [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10, 20, 50]" [responsiveLayout]="'scroll'"
 class="p-datatable-gridlines mt-6"
>
  <ng-template pTemplate="header">
    <tr class="bg-yellow-400">
      <th><p-tableHeaderCheckbox></p-tableHeaderCheckbox></th>
      <th>Item Code</th>
      <th>Item Name</th>
      <th>Current Stock</th>
      <th>UOM</th>
      <th>Qty</th>
      <th>Cost</th>
      <th>Total</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-row>
    <tr>
      <td><p-tableCheckbox [value]="row"></p-tableCheckbox></td>
      <td>{{ row.itemsku }}</td>
      <td>{{ row.itemname }}</td>
      <td>{{ row.current_stock }}</td>
      <td>{{ row.uomname }}</td>
      <td>{{ row.quantity }}</td>
      <td>{{ row.itemcost }}</td>
      <td>{{ row.quantity * row.itemcost }}</td>
    </tr>
  </ng-template>
    <ng-template pTemplate="paginatorleft">
  <div class="flex w-full justify-between">
    
    <span>Total Items: {{ replacecednlist.length }}</span>

    <!-- <p-dropdown
      [options]="state.rowsPerPageOptions"
      [(ngModel)]="state.rows"
      >
    </p-dropdown> -->

  </div>
</ng-template>
</p-table>

    </div>



  
  </form>

  </div>

</div>
  <p-confirmDialog></p-confirmDialog>


<!-- ================================
     PRINT SECTION (INVOICE)
================================= -->
<div class="dn-container" style="margin:auto; width:900px; font-family: Arial;" id="printSection" >
 <h3 style="text-align: center; padding-bottom: 10px;">DEBIT NOTE</h3>

    <!-- ================= COMPANY & CUSTOMER INFO ================= -->
  <table width="100%" cellspacing="0" cellpadding="0" style="margin-bottom:15px;">
    <tr>
      <td width="50%" style="vertical-align:top; padding: 6px">
        <strong>SHRISTI ELECTRICAL</strong><br>
        SHOP NO.-7 SAPNA TALKIES COMPLEX,<br>
        NANDINI ROAD, BHILAI<br>
        GSTIN: 22AOCPY0439F1Z5 | State: Chhattisgarh (22)<br>
        Email: shristielectrical&#64;gmail.com
      </td>
      <td width="50%" style="vertical-align:top;padding: 0; border:none;">
        <table cellpadding="0" cellspacing="0" style=" border:none; border-collapse:collapse;">
          <tr>
            <td><strong>Debit Note No:</strong></td>
            <td>{{ CreditForm.get('p_debitNote')?.value }}</td>
          </tr>
          <tr>
            <td><strong>Date:</strong></td>
            <td>{{ CreditForm.get('p_transactiondate')?.value | date:'dd-MMM-yyyy' }}</td>
          </tr>
          <tr>
            <td><strong>Original Invoice:</strong></td>
            <td>{{ CreditForm.get('p_originalInvoice')?.value || '' }}</td>
          </tr>
          <tr>
            <td><strong>Payment Mode:</strong></td>
            <td>CASH</td>
          </tr>
          <tr>
            <td><strong>Return/Debit To:</strong></td>
            <td><strong>{{ CreditForm.get('p_customername')?.value || '' }}</strong></td>
          </tr>
          <tr>
            <td><strong>Mobile:</strong></td>
            <td>{{ CreditForm.get('p_customermobile')?.value || '' }} </td>
          </tr>
          <tr>
            <td><strong>GSTIN:</strong></td>
            <td>{{ CreditForm.get('p_customergstin')?.value || '' }} </td>
          </tr>
          <tr>
            <td><strong>State:</strong></td>
            <td>{{ CreditForm.get('p_customerstate')?.value || '' }} </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>

  <!-- ================= CUSTOMER DETAILS ================= -->
  <!-- <div style="background:#f5f5f5; padding:10px; margin-bottom:15px;">
    {{ CreditForm.get('p_customeraddress')?.value || '' }}<br>
    Mobile: {{ CreditForm.get('p_customermobile')?.value || '' }} | 
    GSTIN: {{ CreditForm.get('p_customergstin')?.value || '-' }}<br>
    State: {{ CreditForm.get('p_customerstate')?.value || '-' }}
  </div> -->

  <!-- ================= ITEMS TABLE ================= -->
  <table width="100%" border="1" cellspacing="0" cellpadding="6" style="border-collapse:collapse;font-size:14px;">
    <thead style="background:#f0f0f0;">
      <tr>
        <th>SNo.</th>
        <th>Item Description</th>
        <th>Qty</th>
        <th>Unit</th>
        <th>Rate</th>
        <th>Amount</th>
      </tr>
    </thead>
    
    <tbody>
      <tr *ngFor="let row of replacecednlist; let i = index">
        <td align="center">{{ i + 1 }}</td>
        <td>{{ row.itemname }}</td>
        <td align="center">{{ row.quantity }}</td>
        <td align="center">{{ row.uomname || row.current_stock }}</td>
        <td align="right">â‚¹{{ row.mrp | number:'1.2-2' }}</td>
        <td align="right">â‚¹{{ (row.quantity * row.mrp) | number:'1.2-2' }}</td>
      </tr>
      
      <!-- Summary Rows -->
      <!-- <tr>
        <td colspan="6" align="right"><strong>Total Amount:</strong></td>
        <td align="right"><strong>â‚¹{{ totalAmount | number:'1.2-2' }}</strong></td>
      </tr> -->
      
      <!-- <tr>
        <td colspan="6" align="right">CGST "&#64;" 9%:</td>
        <td align="right">â‚¹{{ CreditForm.get('p_cgst')?.value || '0.00' | number:'1.2-2' }}</td>
      </tr>
      
      <tr>
        <td colspan="6" align="right">SGST "&#64;" 9%:</td>
        <td align="right">â‚¹{{ CreditForm.get('p_sgst')?.value || '0.00' | number:'1.2-2' }}</td>
      </tr>
       -->
       <!-- Amount in words & Total Amount block -->
    <tr>
      <!-- <td  rowspan="3" class="bold">
        Amount in words:
      </td>
      <td colspan="5" rowspan="3" class="bold">
     
      </td> -->

      <td colspan="5"  class="bold" style="text-align:right;">
        Total Amount:
      </td>
      <td> <strong>â‚¹{{ totalAmount }}</strong></td>
    </tr>

    <tr>
      <td colspan="3" class="bold" align="right"></td>
       <td colspan="3" class="bold" ></td>
      
    </tr>
     <!-- <tr>
       <td colspan="2" class="bold" align="right">Reference No:</td>
        <td colspan="2" class="bold"></td>
      </tr> -->
   

    <!-- BANK DETAILS + SIGN -->
    <tr>
      <td class="bold">Bank Name:</td>
      <td colspan="2">Shristi Elec bank name	
</td>

   
      <td rowspan="5" colspan="3" style="text-align:center; vertical-align:bottom;">
        Company seal and Sign
      </td>
    </tr>

    <tr>
      <td class="bold">Account Number:</td>
      <td colspan="5"></td>
    </tr>

    <tr>
      <td class="bold">IFSC Code:</td>
      <td colspan="5"></td>
    </tr>
     <tr>
      <td class="bold">Company PAN:</td>
      <td colspan="5"></td>
    </tr>
    </tbody>
  </table>

    <div style="text-align:left; margin-top:10px; color:#666; font-size:12px;">
      <strong>Note:</strong> This is a computer generated debit note.
    </div>
  </div>

