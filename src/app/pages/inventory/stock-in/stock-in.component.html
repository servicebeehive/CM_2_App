<div class="card p-6">
  <!-- Header Row: Stock In + Buttons -->
  <div class="flex justify-between items-center mb-6">
    <span class="block text-surface-900 font-bold text-2xl">Stock In</span>
    <div class="flex gap-4">
       <button pButton type="button" label="Reset" class="p-button-secondary" (click)="reset()"></button>
    </div>
  </div>

  <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="space-y-8">

    <!-- ðŸ· Product Info Section -->
    <div>


      <!-- Two-column grid layout -->
      <div class="grid grid-cols-2 gap-x-8 gap-y-4 w-full">
        <!-- Transaction Id -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Transaction Id</label>
          <p-dropdown
            [options]="transactionIdOptions"
            optionLabel="label"
            optionValue="value"
            [filter]="true"
            filterPlaceholder="Search Transaction Id"
            formControlName="transId"
            placeholder="Auto Generated ID">
          </p-dropdown>
          <!-- <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('transId')?.touched">
            <span *ngIf="productForm.get('transId')?.errors?.['required']">Transaction Id is required</span>
          </small> -->
        </div>

        <!-- Vendor Name -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Vendor Name</label>
           <p-dropdown
            [options]="vendorNameOptions"
            optionLabel="label"
            optionValue="value"
            [filter]="true"
            filterPlaceholder="Search Vendor Name"
            formControlName="vendorName"
            placeholder="Vendor Name">
          </p-dropdown>
          <!-- <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('vendorName')?.touched">
            <span *ngIf="productForm.get('vendorName')?.errors?.['required']">Vendor Name is required</span>
          </small> -->
        </div>

        <!-- Invoice No -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Invoice No.</label>
         <input pInputText formControlName="invoiceNo" placeholder="Invoice No." />
          <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('invoiceNo')?.errors">
            <span *ngIf="productForm.get('invoiceNo')?.errors?.['maxlength']">Invoice No. must have atleast 50 characters</span>
          </small>
        </div>

        <!-- Invoice Date -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Invoice Date</label>
          <p-datepicker  fluid formControlName="invoiceDate" [showIcon]="true" placeholder="Invoice Date"></p-datepicker>
        </div>

        <!-- Remark -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Remark</label>
          <input pInputText formControlName="remark" placeholder="Remark" />
            <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('remark')?.errors">
            <span *ngIf="productForm.get('remark')?.errors?.['maxlength']">Remark must have atleast 500 characters</span>
          </small>
        </div>
      </div>

      <!-- Add and Display Buttons -->
      <div class="flex mt-6 gap-4">
         <button pButton type="submit" label="Sumbit" class="p-button-warning"></button>
        <button pButton type="button" label="Add Item" class="p-button-warning" [disabled]="!addItemEnabled" (click)="openAddDialog()"></button>
        <p class="text-red-500 flex items-center" >To Add Item, Press submit to save the header information even if header informations are blank</p>
      </div>
    </div>

    <!-- Product Table with Pagination -->
    <div>
      <p-table
        [value]="products"
        dataKey="code"
        [tableStyle]="{'min-width': '50rem'}"
        [paginator]="true"
        [rows]="10"
        [rowsPerPageOptions]="[5, 10, 20, 50]"
        [responsiveLayout]="'scroll'"
        class="p-datatable-gridlines mt-6"
      >
        <ng-template #header>
          <tr class="bg-yellow-400">
            <th><p-tableHeaderCheckbox></p-tableHeaderCheckbox></th>
            <th>Item Code</th>
            <th>Item Name</th>
            <th>Category</th>
            <th>Current Stock</th>
            <th>Qty</th>
            <th>Purchase Price</th>
            <th>Total</th>
            <th>UOM</th>
            <th>Child UOM</th>
            <th>MRP</th>
            <th>Discount</th>
            <th>Min Stock</th>
            <th>Warranty Period</th>
            <th>Location</th>
            <th class="text-center">Action</th>
          </tr>
        </ng-template>

        <ng-template #body let-product>
          <tr>
            <td class="text-center">
             <p-tableCheckbox [value]="product" />
            </td>
            <td class="flex justify-between gap-2">{{ product.code}}
               <!-- <span class=" pi pi-copy cursor-pointer "></span> -->
              </td>
            <td routerLink="/stockAjustment" class="cursor-pointer">{{ product.name }}</td>
            <td>{{ product.category }}</td>
            <td>{{ product.curStock }}</td>
            <td>{{ product.quantity }}</td>
            <td>{{ product.purchasePrice }}</td>
            <td>{{ product.total }}</td>
            <td>{{ product.uom }}</td>
            <td>{{ product.childUOM}}</td>
            <td>{{ product.mrp }}</td>
            <td>{{ product.discount }}</td>
            <td>{{ product.minStock }}</td>
            <td>{{ product.warPeriod }}</td>
            <td>{{ product.location }}</td>
            <td class="text-center">
              <i class="pi pi-pencil cursor-pointer text-blue-500" (click)="openEditDialog(product)"></i>
              <i class="pi pi-trash ms-2 cursor-pointer text-red-500" (click)="deleteItem(product)"></i>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="paginatorleft">
          <div class="text-gray-600 ms-2">Total Items: {{ products?.length || 0 }}</div>
        </ng-template>
      </p-table>
    </div>

    <!-- Grand Total -->
    <div class="flex justify-end items-center gap-4 mt-6 border-t pt-4">
      <label class="font-medium">Grand Total</label>
      <input pInputText type="text" [value]="grandTotal" readonly placeholder="Total" class="w-40 text-right" />
    </div>
  </form>

  <!-- Dialog -->
  <p-dialog
    header="{{ mode === 'add' ? 'Add Item' : 'Edit Item' }}"
    [(visible)]="visibleDialog"
    [modal]="true"
    [style]="{ width: '80vw' }"
  >
    <app-addinventory
      [editData]="selectedRow"
      [mode]="mode"
      (close)="closeDialog()"
      (save)="onSave($event)"
      (childUom)="onChildUom($event)"
     >
    </app-addinventory>
  </p-dialog>

  <!-- Confirm Dialog -->
  <p-confirmDialog></p-confirmDialog>
</div>
