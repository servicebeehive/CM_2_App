<div class="card p-6">
  <!-- Header Row: Stock In + Buttons -->
  <div class="flex justify-between items-center mb-6">
    <span class="block text-surface-900 font-bold text-2xl">Stock In</span>
    <div class="flex gap-4">
       <button pButton type="button" class="p-button-secondary" (click)="reset()">Reset</button>
    </div>
  </div>

  <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="space-y-8">

    <!-- ðŸ· Product Info Section -->
    <div>

      <!-- Two-column grid layout -->
      <div class="grid grid-cols-2 gap-x-8 gap-y-4 w-full">
        <!-- Transaction Id -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Transaction Id</label>
          <p-dropdown
            [options]="purchaseIdOptions"
            optionLabel="purchaseid"
            optionValue="purchaseid" (onChange)="purchaseIdDetails($event)"
            [filter]="true"
            filterPlaceholder="Search Transaction Id"
            formControlName="p_tranpurchaseid"
            placeholder="Auto Generated ID">
          </p-dropdown>
          <!-- <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('transId')?.touched">
            <span *ngIf="productForm.get('transId')?.errors?.['required']">Transaction Id is required</span>
          </small> -->
        </div>

        <!-- Vendor Name -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Vendor Name</label>

           <p-dropdown
            [options]="this.vendorOptions"
            optionLabel="fieldname"
            optionValue="fieldid"
            [filter]="true"
            filterPlaceholder="Search Vendor Name"
            formControlName="p_vendorid"
            placeholder="Vendor Name">
          </p-dropdown>
          <!-- <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('vendorName')?.touched">
            <span *ngIf="productForm.get('vendorName')?.errors?.['required']">Vendor Name is required</span>
          </small> -->
        </div>

        <!-- Invoice No -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Invoice No.</label>
         <input pInputText formControlName="p_invoiceno" placeholder="Invoice No." />
          <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('p_invoiceno')?.errors">
            <span *ngIf="productForm.get('p_invoiceno')?.errors?.['maxlength']">Invoice No. must have atleast 50 characters</span>
          </small>
        </div>

        <!-- Invoice Date -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Invoice Date</label>
          <p-datepicker  fluid formControlName="p_invoicedate" dateFormat="dd-mm-yy" [maxDate]="dateTime" [showIcon]="true" placeholder="Invoice Date"></p-datepicker>
        </div>

        <!-- Remark -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Remark</label>
          <input pInputText formControlName="p_remarks" placeholder="Remark" />
            <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('p_remarks')?.errors">
            <span *ngIf="productForm.get('p_remarks')?.errors?.['maxlength']">Remark must have atleast 500 characters</span>
          </small>
        </div>
      </div>

      <!-- Add and Display Buttons -->
      <div class="flex mt-6 gap-4">
         <button pButton type="submit" label="Sumbit" class="p-button-warning"></button>
        <button pButton type="button" label="Add Item" class="p-button-warning" [disabled]="!addItemEnabled" (click)="openAddDialog()"></button>
        <p class="text-red-500 flex items-center" >To Add Item, Press submit to save the header information even if header informations are blank</p>
      </div>
    </div>

    <!-- Product Table with Pagination -->
    <div>
     <p-table
  [value]="itemOptionslist"
  dataKey="purchasedetailid"
  [tableStyle]="{'min-width': '60rem'}"
  [paginator]="true"
  [rows]="10"
  [rowsPerPageOptions]="[ 10, 20, 50]"
  [responsiveLayout]="'scroll'"
  class="p-datatable-gridlines mt-6"
>

  <!-- HEADER -->
  <ng-template pTemplate="header">
    <tr class="bg-yellow-400">
      <th><p-tableHeaderCheckbox></p-tableHeaderCheckbox></th>
      <th>Item Code</th>
      <th>Item Name</th>
      <th>Category</th>
      <th>Current Stock</th>
      <th>Qty</th>
      <!-- <th>Purchase Price</th> -->
      <th>Cost/Item</th>
      <th>Total Cost</th>
        <th>MRP</th>
      <th>UOM</th>
      <th>Child UOM</th>
    
      <th>Discount</th>
      <th>Min Stock</th>
      <th>Warranty(Mon)</th>
      <th>Location</th>
      <th>GST Item</th>
      <th class="text-center">Action</th>
    </tr>
  </ng-template>

  <!-- BODY -->
  <ng-template pTemplate="body" let-product>
    <tr>
      <td class="text-center">
        <p-tableCheckbox [value]="product"></p-tableCheckbox>
      </td>

      <td>{{ product.itemsku }}</td>
      <td>{{ product.itemname }}</td>
      <td>{{ product.categoryname }}</td>
      <td>{{ product.currentstock }}</td>
      <td>{{ product.quantity }}</td>
      <td>{{ product.costprice }}</td>
      <td>{{ product.quantity * product.costprice }}</td>
      <td>{{ product.saleprice }}</td>

      <td>{{ product.uomname }}</td>
      <td>{{ product.childuom }}   <button pButton 
        icon="pi pi-eye" type="button"
        class="p-button-sm p-button-primary ms-2"
        (click)="viewItem(product.itemid)">
</button>
 </td>

      <!-- Discount not in response â†’ left blank -->
      <td>{{product.discount}}</td>

      <td>{{ product.minimumstock }}</td>
      <td>{{ product.warrentyperiod }}</td>
      <td>{{ product.location }}</td>

      <td>{{ product.gstitem === 'Y' ? 'Yes' : 'No' }}</td>

      <td class="text-center">
        <i class="pi pi-pencil cursor-pointer text-blue-500" (click)="openEditDialog(product)"></i>
        <i class="pi pi-trash ms-2 cursor-pointer text-red-500" (click)="deleteItem(product)"></i>
       
      </td>
    </tr>
  </ng-template>

  <!-- PAGINATOR LEFT -->
  <ng-template pTemplate="paginatorleft">
    <div class="text-gray-600 ms-2">Total Items: {{ itemOptionslist?.length || 0 }}</div>
  </ng-template>

</p-table>

    </div>

    <!-- Grand Total -->
    <div class="flex justify-end items-center gap-4 mt-6 border-t pt-4">
      <label class="font-medium">Grand Total</label>
      <input pInputText type="text" [value]="grandTotal" readonly placeholder="Total" class="w-40 text-right" />
    </div>
  </form>

<p-dialog header="Child UOM"  [(visible)]="visibleDialog"
    [modal]="true"
    [style]="{ width: '80vw' }" >

</p-dialog>

  <!-- Dialog -->
  <p-dialog
    header="{{ mode === 'add' ? 'Add Item' : 'Edit Item' }}"
    [(visible)]="visibleDialog"
    [modal]="true"
    [style]="{ width: '80vw' }"
  >
    <app-addinventory
      [mode]="mode"
      [editData]="selectedRow"
      (close)="closeDialog($event)"
      (save)="onSave($event)"
      [transationid]="transationid"
      [itemOptions]="itemOptions"
      [categoryOptions]="categoryOptions"
      [uomOptions]="uomOptions"
      [vendorOptions]="vendorOptions"
      [purchaseIdOptions]="purchaseIdOptions"
      
      (childUom)="onChildUom($event)"
     >
    </app-addinventory>
  </p-dialog>

  <!-- Confirm Dialog -->
  <p-confirmDialog></p-confirmDialog>
</div>
<p-dialog 
  header="Child UOM Details" 
  [(visible)]="childUomDialog" 
  [modal]="true" 
  [style]="{width:'450px'}">

  <p-table 
    [value]="childUOMList"
    [responsiveLayout]="'scroll'"
    class="p-datatable-gridlines">

    <ng-template pTemplate="header">
      <tr class="bg-yellow-400">
        <th>Child UOM</th>
        <th>Conversion</th>
        <th>Child MRP</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-row>
      <tr>
        <td>{{ row.uomname }}</td>
        <td>{{ row.uomconversion }}</td>
        <td>{{ row.childmrp }}</td>
      </tr>
    </ng-template>

  </p-table>
</p-dialog>
