<div class="card">
  <span class="block text-surface-900 font-bold text-xl mb-6">Create Product</span>

  <div>
    <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="space-y-8">

      <!-- ðŸ· Product Info Section -->
      <div>
        <h3 class="text-lg font-semibold mb-4 border-b pb-2 text-gray-700">Product Information</h3>

        <!-- âœ… Changed to a 2-column grid for half-width fields -->
       <div class="grid grid-cols-2 gap-x-8 gap-y-4 w-full">

          <!-- Name -->

          <div class="flex flex-col">
            <label class="font-medium mb-1" [ngClass]=" {'ng-invalid': productForm.get('itemName')?.invalid && productForm.get('itemName')?.touched} ">Name <span class="text-red-500" >*</span></label>
            <input pInputText formControlName="itemName" placeholder="Enter name" />
             <small class="text-red-500 mt-1 ms-3" *ngIf="productForm.get('itemName')?.touched && productForm.get('itemName')?.errors">
    <span *ngIf="productForm.get('itemName')?.errors?.['required']">Name is required.</span>
    <span *ngIf="productForm.get('itemName')?.errors?.['minlength']">
      Name must be at least 3 characters.
    </span>
  </small>
          </div>


             <!-- Purchase Price -->
         <!-- Wrap them in a grid with 4 equal columns -->
             <div class="flex flex-col col-span-2">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 w-full">

  <!-- Purchase Price -->
  <div class="flex flex-col">
    <label class="font-medium mb-1">Purchase Price <span class="text-red-500">*</span></label>
    <input pInputText type="number" formControlName="purchasePrice" placeholder="Purchase Price" />
    <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('purchasePrice')?.touched && productForm.get('purchasePrice')?.errors">
      <span *ngIf="productForm.get('purchasePrice')?.errors?.['required']">Purchase Price is required</span>
      <span *ngIf="productForm.get('purchasePrice')?.errors?.['min']">Purchase Price must be greater than 0</span>
    </small>
  </div>

  <!-- MRP -->
  <div class="flex flex-col">
    <label class="font-medium mb-1">MRP</label>
    <input pInputText type="number" formControlName="mrp" placeholder="MRP" />
    <small class="text-red-500 ms-3 mt-1">
      <span *ngIf="productForm.get('mrp')?.touched && (productForm.errors?.['mrpGreaterThanPurchase'])"> MRP must greater than or equal to Purchase Price</span>
    </small>
  </div>

  <!-- Quantity -->
  <div class="flex flex-col">
    <label class="font-medium mb-1">Quantity</label>
    <input pInputText type="number" formControlName="quantity" placeholder="Quantity" />
    <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('quantity')?.touched && productForm.get('quantity')?.errors">
      <span  *ngIf="productForm.get('quantity')?.errors?.['required']">Quantity is required</span>
      <span *ngIf="productForm.get('quantity')?.errors?.['min']">Quantity should be greater equal than 1</span>
    </small>
  </div>

  <!-- Min Stock -->
  <div class="flex flex-col">
    <label class="font-medium mb-1">Min Stock</label>
    <input pInputText type="number" formControlName="minStock" placeholder="Min Stock" />
     <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('minStock')?.errors">
      <span *ngIf="productForm.get('minStock')?.errors?.['min']">Stock should be greater than 0</span>
    </small>
  </div>

</div>
             </div>



          <!-- Description -->
          <div class="flex flex-col col-span-2">
            <label class="font-medium mb-1">Description</label>
            <textarea rows="4" pTextarea formControlName="description" placeholder="Enter description"></textarea>
            <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('description')?.errors">
               <span *ngIf="productForm.get('description')?.errors?.['maxlength']">Description must be less than 300 characters</span>
            </small>
          </div>

          <!-- Parent UOM -->
          <div class="flex flex-col">
            <label class="font-medium mb-1">Parent UOM</label>
            <p-dropdown
              [options]="uomOptions"
              optionLabel="label"
              optionValue="value"
              [filter]="true"
              filterPlaceholder="Search UOM"
              formControlName="parentUOM"
              placeholder="Select UOM">
            </p-dropdown>
             <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('parentUOM')?.touched">
      <span  *ngIf="productForm.get('parentUOM')?.errors?.['required']">Parent UOM is required</span>
    </small>
          </div>

          <!-- Category -->
          <div class="flex flex-col">
            <label class="font-medium mb-1">Category</label>
            <p-dropdown
              [options]="categoryOptions"
              optionLabel="label"
              optionValue="value"
              [filter]="true"
              filterPlaceholder="Search Category"
              formControlName="category"
              placeholder="Select Category">
            </p-dropdown>
             <small class="text-red-500 ms-3 mt-1" *ngIf="productForm.get('category')?.touched">
      <span  *ngIf="productForm.get('category')?.errors?.['required']">Category is required</span>
    </small>
          </div>



          <!-- Location -->
          <div class="flex flex-col">
            <label class="font-medium mb-1">Location</label>
            <input pInputText formControlName="location" placeholder="Warehouse / Store" />
          </div>

          <!-- Warranty -->
          <div class="flex flex-col">
            <label class="font-medium mb-1">Warranty Period</label>
            <input pInputText formControlName="warrantyPeriod" placeholder="e.g. 12 Months" />
          </div>

          <!-- Discount -->
          <div class="flex flex-col">
            <label class="font-medium mb-1">Discount</label>
            <input pInputText type="number" formControlName="discount" placeholder="Discount %" />
          </div>

          <!-- Image Upload -->
          <div class="flex flex-col col-span-2">
            <label class="font-medium mb-1">Image</label>
            <p-fileUpload mode="basic" name="file" auto="true" chooseLabel="Upload Image"
              accept="image/*" maxFileSize="5000000" (onUpload)="onImageUpload($event)">
            </p-fileUpload>
            <small class="text-gray-500">(Recommended: .jpg | Max: 5MB)</small>
          </div>

          <!-- Product Gallery (Take full row) -->
          <div class="flex flex-col col-span-2">
            <label class="font-medium mb-1">Product Gallery</label>
            <p-fileUpload name="gallery[]" customUpload="true" [multiple]="true"
              (uploadHandler)="onGalleryUpload($event)"
              accept="image/*" maxFileSize="5000000"
              chooseLabel="Drag & Drop or Browse"
              class="border border-dashed border-gray-400 rounded-md p-4">
            </p-fileUpload>
          </div>

        </div>
      </div>

      <!-- ðŸ§¾ Child UOM Section -->
      <div>
        <h3 class="text-lg font-semibold mb-4 border-b pb-2 text-gray-700">Child UOM Conversion</h3>
        <p-table [value]="[]" class="p-datatable-gridlines">
          <ng-template pTemplate="header">
            <tr class="bg-yellow-400">
              <th>Child UOM</th>
              <th>Conversion</th>
              <th>MRP</th>
              <th class="text-center">Action</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-row let-i="rowIndex">
            <tr [formGroupName]="i">
              <td><input pInputText formControlName="childUOM" /></td>
              <td><input pInputText type="number" formControlName="conversion" /></td>
              <td><input pInputText type="number" formControlName="childMRP" /></td>
              <td class="text-center">
                <button pButton type="button" icon="pi pi-plus" class="p-button-rounded p-button-success mr-2"
                        (click)="addChildUOM()"></button>
                <button pButton type="button" icon="pi pi-minus" class="p-button-rounded p-button-danger"
                        (click)="removeChildUOM(i)"></button>
              </td>
            </tr>
          </ng-template>
        </p-table>
        <div *ngIf="childUOMs.errors?.['minChildRows'] && childUOMs.touched">
          <small class="text-red-500">
            You must have atleast one Child UOM row.
          </small>
        </div>
      </div>

      <!-- Buttons -->
      <div class="flex justify-end gap-4">
        <button pButton type="submit" label="Save" class="p-button-warning"></button>
        <button pButton type="button" label="Cancel" class="p-button-secondary"></button>
      </div>
    </form>
  </div>
</div>
