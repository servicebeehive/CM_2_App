<div class="card p-6">
    <div class="flex justify-between items-center mb-6">
        <span class="block text-surface-900 font-bold text-xl mb-6">Configuration</span>

        <div class="flex gap-4">
            <button pButton *ngIf="loggedInUserRole === 'Admin'" type="button" label="Add User" icon="pi pi-plus" class="p-button-warning" (click)="openUserDialog()"></button>
        </div>
    </div>

    <!-- ðŸ” Compact Global Search Section -->
    <div class="mb-3 w-full" *ngIf="showGlobalSearch">
        <app-global-filter [(value)]="globalFilter" placeholder="Search Items..." (valueChange)="applyGlobalFilter()"></app-global-filter>
    </div>

    <!-- ðŸ“‹ User Table -->
    <p-table [value]="filteredUser" dataKey="id" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[ 10, 20]" [responsiveLayout]="'scroll'" class="p-datatable-gridlines mt-6">
        <ng-template pTemplate="header">
            <tr>
                <th>Rule Name</th>
                <th>Description</th>
                <th>Rule Value</th>
                <th class="text-center">Action</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-user>
            <tr>
                <td>{{ user.usertypename }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.fullname }}</td>
                
                <td class="text-center">
                    <i class="pi pi-pencil cursor-pointer text-blue-500" (click)="openEditDialog(user)"></i>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="paginatorleft">
            <div class="text-gray-600 ms-2">Total Users: {{ filteredUser?.length || 0 }}</div>
        </ng-template>
    </p-table>

    <!-- âœ³ï¸ Add/Edit User Dialog -->
    <p-dialog header="{{ editMode ? 'Edit User' : 'Add User' }}" [(visible)]="visibleDialog" [modal]="true" [style]="{ width: '60vw' }" [draggable]="false" [resizable]="false">
        <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="space-y-6">
            <div class="grid grid-cols-2 gap-x-6 gap-y-4">
                <!-- User Name -->
                <div class="flex flex-col">
                    <label class="font-medium mb-1">Rule Name <span class="text-red-500">*</span></label>
                    <input pInputText formControlName="p_uname" placeholder="Rule Name" />
                    <!-- <small class="text-red-500 mt-1" *ngIf="userForm.get('p_uname')?.touched && userForm.get('p_uname')?.invalid"> User Name is required </small> -->
                </div>

                <!-- User Role -->
                <div class="flex flex-col">
                    <label class="font-medium mb-1">Rule Description <span class="text-red-500">*</span></label>
                    <p-dropdown [options]="userRoleOptions" optionLabel="fieldname" optionValue="fieldid" formControlName="p_utypeid" placeholder="Select Description"></p-dropdown>
                    <!-- <small class="text-red-500 mt-1" *ngIf="userForm.get('p_utypeid')?.touched && userForm.get('p_utypeid')?.invalid"> User Role is required </small> -->
                </div>

                <!-- Password -->
                <div class="flex flex-col relative">
                    <label class="font-medium mb-1">Rule Value <span class="text-red-500">*</span></label>
                    <div>
                        <input pInputText formControlName="p_pwd" placeholder="Rule Value" class="w-full pr-10" />
                      </div>
                    <small class="text-red-500 mt-1" *ngIf="userForm.get('p_pwd')?.touched && userForm.get('p_pwd')?.invalid"> Password must contain uppercase, lowercase, number, and special character </small>
                </div>
            </div>

            <div class="flex justify-end gap-4 mt-6">
                <button pButton type="button" label="Cancel" class="p-button-secondary" (click)="closeDialog()"></button>
                <button pButton type="submit" label="Submit" class="p-button-warning" [disabled]="userForm.invalid"></button>
            </div>
        </form>
    </p-dialog>

    <p-confirmDialog></p-confirmDialog>
</div>
