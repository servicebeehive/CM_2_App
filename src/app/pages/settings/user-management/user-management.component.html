<div class="card p-6">
  <div class="flex justify-between items-center mb-6">
    <span class="block text-surface-900 font-bold text-xl mb-6">User Management</span>

    <div class="flex gap-4">
      <button
        pButton
        *ngIf="loggedInUserRole==='Admin'"
        type="button"
        label="Add User"
        icon="pi pi-plus"
        class="p-button-warning"
        (click)="openUserDialog()"
      ></button>
    </div>
  </div>

<!-- ðŸ” Compact Global Search Section -->
   <div  class="mb-3 w-full" *ngIf="showGlobalSearch">
                        <app-global-filter  [(value)]="globalFilter" placeholder="Search Items..." (valueChange)="applyGlobalFilter()"></app-global-filter>
                     </div>


  <!-- ðŸ“‹ User Table -->
  <p-table
    [value]="filteredUser"
    dataKey="id"
    [paginator]="true"
    [rows]="5"
    [rowsPerPageOptions]="[5, 10, 20]"
    [responsiveLayout]="'scroll'"
    class="p-datatable-gridlines mt-6"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>User Role</th>
        <th>User Name</th>
        <th>Full Name</th>
        <th>Mobile</th>
        <th>Email</th>
        <th>Active</th>
        <th class="text-center">Action</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-user>
      <tr>
        <td>{{ user.usertypename }}</td>
        <td>{{ user.username }}</td>
        <td>{{ user.fullname}}</td>
        <td>{{ user.phone }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.isactive }}</td>
        <td class="text-center">
          <i
            class="pi pi-pencil cursor-pointer text-blue-500"
            (click)="openEditDialog(user)"
          ></i>
          <!-- <i
            class="pi pi-trash ms-2 cursor-pointer text-red-500"
            (click)="deleteItem(user)"
          ></i> -->
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="paginatorleft">
      <div class="text-gray-600 ms-2">
        Total Users: {{ filteredUser?.length || 0 }}
      </div>
    </ng-template>
  </p-table>

  <!-- âœ³ï¸ Add/Edit User Dialog -->
  <p-dialog
    header="{{ editMode ? 'Edit User' : 'Add User' }}"
    [(visible)]="visibleDialog"
    [modal]="true"
    [style]="{ width: '60vw' }"
    [draggable]="false"
    [resizable]="false"
  >
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="space-y-6">
      <div class="grid grid-cols-2 gap-x-6 gap-y-4">
        <!-- User Name -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">User Name <span class="text-red-500">*</span></label>
          <input pInputText formControlName="p_uname" placeholder="User Name" />
          <small class="text-red-500 mt-1" *ngIf="userForm.get('p_uname')?.touched && userForm.get('p_uname')?.invalid">
            User Name is required
          </small>
        </div>

        <!-- User Role -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">User Role <span class="text-red-500">*</span></label>
          <p-dropdown
            [options]="userRoleOptions"
            optionLabel="fieldname"
            optionValue="fieldid"
            formControlName="p_utypeid"
            placeholder="Select Role"
          ></p-dropdown>
          <small class="text-red-500 mt-1" *ngIf="userForm.get('p_utypeid')?.touched && userForm.get('p_utypeid')?.invalid">
            User Role is required
          </small>
        </div>


        <!-- Password -->
        <div class="flex flex-col relative">
          <label class="font-medium mb-1">Password <span class="text-red-500">*</span></label>
          <div class="relative">
            <input
              pInputText
              [type]="showPassword ? 'text' : 'password'"
              formControlName="p_pwd"
              placeholder="Password"
              class="w-full pr-10"
            />
            <i
              class="pi"
              [ngClass]="showPassword ? 'pi-eye-slash' : 'pi-eye'"
              (click)="showPassword = !showPassword"
              style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;"
            ></i>
          </div>
          <small class="text-red-500 mt-1" *ngIf="userForm.get('p_pwd')?.touched && userForm.get('p_pwd')?.invalid">
            Password must contain uppercase, lowercase, number, and special character
          </small>
        </div>

        <!-- Confirm Password -->
        <div class="flex flex-col relative">
          <label class="font-medium mb-1">Confirm Password <span class="text-red-500">*</span></label>
          <div class="relative">
            <input
              pInputText
              [type]="showConfirmPassword ? 'text' : 'password'"
              formControlName="conPassword"
              placeholder="Confirm Password"
              class="w-full pr-10"
            />
            <i
              class="pi"
              [ngClass]="showConfirmPassword ? 'pi-eye-slash' : 'pi-eye'"
              (click)="showConfirmPassword = !showConfirmPassword"
              style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;"
            ></i>
          </div>
          <small class="text-red-500 mt-1" *ngIf="userForm.hasError('passwordMismatch')">
            Passwords do not match
          </small>
        </div>

<!-- User Full Name -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Full Name <span class="text-red-500">*</span></label>
          <input pInputText formControlName="p_ufullname" placeholder="Full Name" />
          <small class="text-red-500 mt-1" *ngIf="userForm.get('p_ufullname')?.touched && userForm.get('p_ufullname')?.invalid">
            User Full Name is required
          </small>
        </div>


        <!-- Mobile -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Mobile <span class="text-red-500">*</span></label>
          <input
            pInputText
            type="text"
            formControlName="p_phone"
            maxlength="10"
            placeholder="mobile"
            (keypress)="allowOnlyDigits($event)"
          />
          <small class="text-red-500 mt-1" *ngIf="userForm.get('p_phone')?.touched && userForm.get('p_phone')?.invalid">
            Enter a valid 10-digit mobile number
          </small>
        </div>

        <!-- Email -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Email <span class="text-red-500">*</span></label>
          <input pInputText type="email" formControlName="p_email" placeholder="Email" />
          <small class="text-red-500 mt-1" *ngIf="userForm.get('p_email')?.touched && userForm.get('p_email')?.invalid">
            Enter a valid email address
          </small>
        </div>

        <!-- Active -->
        <div class="flex gap-3 mt-9">
          <p-checkbox formControlName="checked" [binary]="true"></p-checkbox>
          <label class="font-medium">Active</label>
        </div>
      </div>

      <div class="flex justify-end gap-4 mt-6">
        <button pButton type="button" label="Cancel" class="p-button-secondary" (click)="closeDialog()"></button>
        <button pButton type="submit" label="Submit" class="p-button-warning" [disabled]="userForm.invalid"></button>
      </div>
    </form>
  </p-dialog>

  <p-confirmDialog></p-confirmDialog>
</div>
