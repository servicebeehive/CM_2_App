<div class="card p-6">
  <div class="flex justify-between items-center mb-6">
    <span class="block text-surface-900 font-bold text-xl mb-6">User Management</span>

    <div class="flex gap-4">
      <button
        pButton
        type="button"
        label="Add User"
        icon="pi pi-plus"
        class="p-button-warning"
        (click)="openUserDialog()"
      ></button>
    </div>
  </div>

<!-- ðŸ” Compact Global Search Section -->
<div class="grid grid-cols-9 gap-4 mb-4 items-center">


  <div class="col-span-3 flex items-center gap-2">

    <input
      type="text"
      pInputText
      placeholder="Search..."
      (input)="applyGlobalFilter($event)"
      class="w-full p-inputtext-sm"
    />
  </div>
</div>


  <!-- ðŸ“‹ User Table -->
  <p-table
    [value]="filteredProducts"
    dataKey="id"
    [paginator]="true"
    [rows]="5"
    [rowsPerPageOptions]="[5, 10, 20]"
    [responsiveLayout]="'scroll'"
    class="p-datatable-gridlines mt-6"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>User Role</th>
        <th>User Name</th>
        <th>Mobile</th>
        <th>Email</th>
        <th>Active</th>
        <th class="text-center">Action</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-user>
      <tr>
        <td>{{ user.userRole }}</td>
        <td>{{ user.userName }}</td>
        <td>{{ user.mobile }}</td>
        <td>{{ user.email }}</td>
        <td>{{ user.active }}</td>
        <td class="text-center">
          <i
            class="pi pi-pencil cursor-pointer text-blue-500"
            (click)="openEditDialog(user)"
          ></i>
          <i
            class="pi pi-trash ms-2 cursor-pointer text-red-500"
            (click)="deleteItem(user)"
          ></i>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="paginatorleft">
      <div class="text-gray-600 ms-2">
        Total Users: {{ filteredProducts?.length || 0 }}
      </div>
    </ng-template>
  </p-table>

  <!-- âœ³ï¸ Add/Edit User Dialog -->
  <p-dialog
    header="{{ editMode ? 'Edit User' : 'Add User' }}"
    [(visible)]="visibleDialog"
    [modal]="true"
    [style]="{ width: '60vw' }"
    [draggable]="false"
    [resizable]="false"
  >
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="space-y-6">
      <div class="grid grid-cols-2 gap-x-6 gap-y-4">
        <!-- User Name -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">User Name <span class="text-red-500">*</span></label>
          <input pInputText formControlName="userName" placeholder="User Name" />
          <small class="text-red-500 mt-1" *ngIf="userForm.get('userName')?.touched && userForm.get('userName')?.invalid">
            User Name is required
          </small>
        </div>

        <!-- User Role -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">User Role <span class="text-red-500">*</span></label>
          <p-dropdown
            [options]="userRoleOptions"
            optionLabel="label"
            optionValue="value"
            formControlName="userRole"
            placeholder="Select Role"
          ></p-dropdown>
          <small class="text-red-500 mt-1" *ngIf="userForm.get('userRole')?.touched && userForm.get('userRole')?.invalid">
            User Role is required
          </small>
        </div>

 <!-- Mobile -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Mobile <span class="text-red-500">*</span></label>
          <input
            pInputText
            type="text"
            formControlName="mobile"
            maxlength="10"
            placeholder="Mobile"
            (keypress)="allowOnlyDigits($event)"
          />
          <small class="text-red-500 mt-1" *ngIf="userForm.get('mobile')?.touched && userForm.get('mobile')?.invalid">
            Enter a valid 10-digit mobile number
          </small>
        </div>

        <!-- Email -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Email <span class="text-red-500">*</span></label>
          <input pInputText type="email" formControlName="email" placeholder="Email" />
          <small class="text-red-500 mt-1" *ngIf="userForm.get('email')?.touched && userForm.get('email')?.invalid">
            Enter a valid email address
          </small>
        </div>

        <!-- Password -->
        <div class="flex flex-col relative">
          <label class="font-medium mb-1">Password <span class="text-red-500">*</span></label>
          <div class="relative">
            <input
              pInputText
              [type]="showPassword ? 'text' : 'password'"
              formControlName="password"
              placeholder="Password"
              class="w-full pr-10"
            />
            <i
              class="pi"
              [ngClass]="showPassword ? 'pi-eye-slash' : 'pi-eye'"
              (click)="showPassword = !showPassword"
              style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;"
            ></i>
          </div>
          <small class="text-red-500 mt-1" *ngIf="userForm.get('password')?.touched && userForm.get('password')?.invalid">
            Password must contain uppercase, lowercase, number, and special character
          </small>
        </div>

        <!-- Confirm Password -->
        <div class="flex flex-col relative">
          <label class="font-medium mb-1">Confirm Password <span class="text-red-500">*</span></label>
          <div class="relative">
            <input
              pInputText
              [type]="showConfirmPassword ? 'text' : 'password'"
              formControlName="conPassword"
              placeholder="Confirm Password"
              class="w-full pr-10"
            />
            <i
              class="pi"
              [ngClass]="showConfirmPassword ? 'pi-eye-slash' : 'pi-eye'"
              (click)="showConfirmPassword = !showConfirmPassword"
              style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;"
            ></i>
          </div>
          <small class="text-red-500 mt-1" *ngIf="userForm.hasError('passwordMismatch')">
            Passwords do not match
          </small>
        </div>

       
        <!-- Active -->
        <div class="flex items-center gap-2 col-span-2 mt-2">
          <label class="font-medium">Active</label>
          <p-checkbox formControlName="checked" [binary]="true"></p-checkbox>
        </div>
      </div>

      <div class="flex justify-end gap-4 mt-6">
        <button pButton type="button" label="Cancel" class="p-button-secondary" (click)="closeDialog()"></button>
        <button pButton type="submit" label="Submit" class="p-button-warning" [disabled]="userForm.invalid"></button>
      </div>
    </form>
  </p-dialog>

  <p-confirmDialog></p-confirmDialog>
</div>
