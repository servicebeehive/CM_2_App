<div class="card p-6">
  <div class="flex justify-between items-center mb-6">
    <span class="block text-surface-900 font-bold text-xl mb-6">Tax Master</span>

    <div class="flex gap-4">
      <button
        pButton
        *ngIf="loggedInUserRole==='Admin'"
        type="button"
        label="Add Tax"
        icon="pi pi-plus"
        class="p-button-warning"
        (click)="openUserDialog()"
      ></button>
    </div>
  </div>

<!-- ðŸ” Compact Global Search Section -->
   <div  class="mb-3 w-full" *ngIf="showGlobalSearch">
                        <app-global-filter  [(value)]="globalFilter" placeholder="Search Items..." (valueChange)="applyGlobalFilter()"></app-global-filter>
                     </div>


  <!-- ðŸ“‹ User Table -->
  <p-table
    [value]="filteredUser"
    dataKey="id"
    [paginator]="true"
    [rows]="5"
    [rowsPerPageOptions]="[5, 10, 20]"
    [responsiveLayout]="'scroll'"
    class="p-datatable-gridlines mt-6"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Type</th>
        <th>Name</th>
        <th>Description</th>  
        <th>Percentage</th>
        <th>Active</th>
        <th class="text-center">Action</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-user>
      <tr>
        <td>{{ user.usertypename }}</td>
        <td>{{ user.username }}</td>
        <td>{{ user.fullname}}</td>
        <td>GST</td>
        <td>{{ user.email }}</td>
        <td>{{ user.isactive }}</td>
        <td></td>
        <td class="text-center">
          <i
            class="pi pi-pencil cursor-pointer text-blue-500"
            (click)="openEditDialog(user)"
          ></i>
          <!-- <i
            class="pi pi-trash ms-2 cursor-pointer text-red-500"
            (click)="deleteItem(user)"
          ></i> -->
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="paginatorleft">
      <div class="text-gray-600 ms-2">
        Total Users: {{ filteredUser?.length || 0 }}
      </div>
    </ng-template>
  </p-table>

  <!-- âœ³ï¸ Add/Edit User Dialog -->
  <p-dialog
    header="{{ editMode ? 'Edit Tax' : 'Add Tax' }}"
    [(visible)]="visibleDialog"
    [modal]="true"
    [style]="{ width: '60vw' }"
    [draggable]="false"
    [resizable]="false"
  >
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="space-y-6">
      <div class="grid grid-cols-2 gap-x-6 gap-y-4">
        <!-- Tax Name -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Tax Name <span class="text-red-500">*</span></label>
          <input pInputText formControlName="p_taxname" placeholder="Tax Name" />
          <small class="text-red-500 mt-1" *ngIf="userForm.get('p_taxname')?.touched && userForm.get('p_taxname')?.invalid">
            Tax Name is required
          </small>
        </div>

        <!--  Tax Type -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Tax Type <span class="text-red-500">*</span></label>
          <p-dropdown
            [options]="userRoleOptions"
            optionLabel="fieldname"
            optionValue="fieldid"
            formControlName="p_taxtypeid"
            placeholder="Select Type"
          ></p-dropdown>
          <small class="text-red-500 mt-1" *ngIf="userForm.get('p_utypeid')?.touched && userForm.get('p_utypeid')?.invalid">
            Tax Type is required
          </small>
        </div>

<!-- Tax Description -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Tax Description <span class="text-red-500">*</span></label>
          <input pInputText formControlName="p_taxdesc" placeholder="Tax Description" />
          <small class="text-red-500 mt-1" *ngIf="userForm.get('p_taxdesc')?.touched && userForm.get('p_taxdesc')?.invalid">
            Tax Description is required
          </small>
        </div>


        <!-- Tax Percentage -->
        <div class="flex flex-col">
          <label class="font-medium mb-1">Percentage <span class="text-red-500">*</span></label>
          <input
            pInputText
            type="text"
            formControlName="p_taxpercentage"
            maxlength="10"
            placeholder="Percentage"
          />
        </div>

        <!-- Active -->
        <div class="flex gap-3">
          <p-checkbox formControlName="checked" [binary]="true"></p-checkbox>
          <label class="font-medium">Active</label>
        </div>
      </div>

      <div class="flex justify-end gap-4 mt-6">
        <button pButton type="button" label="Cancel" class="p-button-secondary" (click)="closeDialog()"></button>
        <button pButton type="submit" label="Submit" class="p-button-warning" [disabled]="userForm.invalid"></button>
      </div>
    </form>
  </p-dialog>

  <p-confirmDialog></p-confirmDialog>
</div>
